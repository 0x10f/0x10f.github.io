(this["webpackJsonpfractal-frontend"]=this["webpackJsonpfractal-frontend"]||[]).push([[0],{13:function(e,t,i){e.exports=i(21)},18:function(e,t,i){},19:function(e,t,i){},20:function(e,t,i){},21:function(e,t,i){"use strict";i.r(t);var n=i(5),a=i.n(n),s=i(9),r=i.n(s),h=(i(18),i(19),i(1)),o=i(2),l=i(3),c=i(4),u=(i(20),i(0)),d=new Map,f=function(e){if(d.has(e))return d.get(e);var t=new u.G(e);return d.set(e,t),t},p=(new Map,new Map,new Map),v=function(e){if(p.has(e))return p.get(e);for(var t=new Uint8Array(e),i=0;i<=t.length;i++)t[i]=i/t.length*256;var n=new u.g(t,t.length,1,u.p);return n.minFilter=u.x,n.magFilter=u.x,n.generateMipmaps=!1,p.set(e,n),n},g=function(){function e(){Object(h.a)(this,e),this.group=new u.k}return Object(o.a)(e,[{key:"position",get:function(){return this.group.position}},{key:"scale",get:function(){return this.group.scale}}]),e}(),w=function(e){Object(c.a)(i,e);var t=Object(l.a)(i);function i(e,n,a,s,r,o){var l;return Object(h.a)(this,i),(l=t.call(this)).dotGeometry=void 0,l.dotMaterial=void 0,l.dotMesh=void 0,l.team=null,l.health=0,l.dotGeometry=f(o),l.dotMaterial=new u.w({color:new u.f("#ff0000"),gradientMap:v(a)}),l.dotMesh=new u.t(l.dotGeometry,l.dotMaterial),l.dotMesh.scale.multiplyScalar(1.1),l.dotMesh.visible=!1,l.dotMesh.renderOrder=2,l.group.add(l.dotMesh),l}return Object(o.a)(i,[{key:"damage",value:function(e,t){if(null!==this.team&&this.team.id!==t.id)return 0;var i=0;0===this.health?(1===e?(this.dotMaterial.color=(new u.f).copy(t.color),this.dotMesh.visible=!0,this.health=1,i=1):(this.dotMaterial.color=(new u.f).copy(t.color),this.dotMesh.visible=!0,this.health=Math.floor(e/2),i=e-this.health),this.team=t):this.health-e<0?(this.dotMaterial.color=(new u.f).copy(t.color),this.dotMesh.visible=!0,this.health=Math.floor((e-this.health)/2),i=e-this.health,this.team=null):this.health-e===0?(this.dotMaterial.color=(new u.f).copy(new u.f("#111111")),this.dotMesh.visible=!1,this.health=0,i=this.health,this.team=null):(this.health-=e,i=e);var n=Math.floor((this.health+100)/100)/6;return this.dotMesh.scale.set(1,1,1).multiplyScalar(n).multiplyScalar(1.1),i}}]),i}(g),m=function(e){return Math.floor((e+100)/100)/6},M=function(e,t){var i=e.getHSL({h:0,s:0,l:0}),n=i.h,a=i.s,s=i.l;return(s-=t)<0&&(s=0),(new u.f).setHSL(n,a,s)},y=function(e,t){return Math.floor(Math.random()*(t-e))+e},b=function(e){Object(c.a)(i,e);var t=Object(l.a)(i);function i(e,n,a,s){var r;return Object(h.a)(this,i),(r=t.call(this)).team=e,r.health=n,r.start=a,r.path=s,r.shellGeometry=void 0,r.shellMaterial=void 0,r.shellMesh=void 0,r.outlineGeometry=void 0,r.outlineMaterial=void 0,r.outlineMesh=void 0,r.alpha=0,r.stepTime=0,r.stepSource=new u.L,r.easing=S(5.5),r.shellGeometry=f(6),r.shellMaterial=new u.w({color:e.color,gradientMap:v(10),side:u.j}),r.shellMesh=new u.t(r.shellGeometry,r.shellMaterial),r.shellMesh.renderOrder=1,r.group.add(r.shellMesh),r.outlineGeometry=f(6),r.outlineMaterial=new u.v({color:M(r.team.color,.2),side:u.b}),r.outlineMesh=new u.t(r.outlineGeometry,r.outlineMaterial),r.outlineMesh.scale.multiplyScalar(1.05),r.outlineMesh.renderOrder=0,r.group.add(r.outlineMesh),r.position.copy(r.stepSource),r.scale.multiplyScalar(m(r.health)),r.stepSource.copy(r.start),r}return Object(o.a)(i,[{key:"damage",value:function(e){this.health-=e,this.health<0&&(this.health=0),0!==this.health&&this.group.scale.set(1,1,1).multiplyScalar(m(this.health))}},{key:"update",value:function(e){if(!this.path.complete()){var t=this.path.peek(),i=(new u.L).addVectors(this.stepSource,t.delta());this.stepTime+=e,this.alpha=this.easing(this.stepTime/t.time),this.alpha>1&&(this.alpha=1),this.position.copy((new u.L).lerpVectors(this.stepSource,i,this.alpha)),1===this.alpha&&(this.path.poll(),this.stepSource=i,this.alpha=this.stepTime=0)}}},{key:"hasReachedVoxel",value:function(){return 0===this.alpha}},{key:"dead",value:function(){return 0===this.health||this.path.complete()}}]),i}(g),L=function(){function e(t){Object(h.a)(this,e),this.steps=t,this.index=0}return Object(o.a)(e,[{key:"peek",value:function(){return this.steps[this.index]}},{key:"poll",value:function(){return this.steps[this.index++]}},{key:"complete",value:function(){return this.index===this.steps.length}}]),e}(),O=function(){function e(t,i,n){Object(h.a)(this,e),this.direction=t,this.distance=i,this.time=n}return Object(o.a)(e,[{key:"delta",value:function(){return(new u.L).copy(this.direction.vector).multiplyScalar(this.distance)}}]),e}(),x=function e(t){Object(h.a)(this,e),this.vector=t};x.UP=new x(new u.L(0,1,0)),x.DOWN=new x(new u.L(0,-1,0)),x.LEFT=new x(new u.L(1,0,0)),x.RIGHT=new x(new u.L(-1,0,0)),x.FORWARD=new x(new u.L(0,0,1)),x.BACK=new x(new u.L(0,0,-1));var S=function(e){var t=function(t){return 1/(1+Math.exp(-e*t))-.5},i=.5/t(1);return function(e){return e=u.r.clamp(e,0,1),i*t(2*e-1)+.5}},z=function(){function e(t,i){Object(h.a)(this,e),this.id=t,this.color=i,e.ALL.set(t,this)}return Object(o.a)(e,null,[{key:"fromID",value:function(t){return e.ALL.get(t)}},{key:"count",value:function(){return e.ALL.size}}]),e}();z.ALL=new Map,z.TEAM_A=new z(0,(new u.f).setHSL(0,.5,.5)),z.TEAM_B=new z(1,(new u.f).setHSL(.4,.5,.5)),z.TEAM_C=new z(2,(new u.f).setHSL(.6,.5,.5)),z.TEAM_D=new z(3,(new u.f).setHSL(.8,.5,.5));var k=function(e){Object(c.a)(i,e);var t=Object(l.a)(i);function i(e,n,a){var s;Object(h.a)(this,i),(s=t.call(this)).size=e,s.voxelSize=n,s.spacing=a,s.volume=void 0,s.length=void 0,s.voxels=void 0,s.guidelines=void 0,s.tracers=new Array,s.tracerSpawnThreshold=300,s.tracerSpawnCounter=0,s.shellGeometry=void 0,s.shellMaterial=void 0,s.shellsMesh=void 0,s.highlightGeometry=void 0,s.highlightMaterial=void 0,s.highlightMesh=void 0,s.volume=s.size*s.size*s.size,s.length=(s.size-1)*s.spacing,s.voxels=new Array(s.size);for(var r=0;r<s.size;r++){s.voxels[r]=new Array(s.size);for(var o=0;o<s.size;o++)s.voxels[r][o]=new Array(s.size)}for(var l=0;l<s.size;l++)for(var c=0;c<s.size;c++)for(var d=0;d<s.size;d++){var f=s.voxels[l][c][d]=new w(n,new u.f("#111111"),5,new u.f("#ffffff"),1.05,6);f.group.position.set(l*s.spacing-s.length/2,c*s.spacing-s.length/2,d*s.spacing-s.length/2),s.group.add(f.group)}s.shellGeometry=new u.c(s.voxelSize,s.voxelSize,s.voxelSize),s.shellMaterial=new u.u({color:new u.f("#111111"),side:u.b}),s.shellsMesh=new u.l(s.shellGeometry,s.shellMaterial,s.volume),s.shellsMesh.renderOrder=0,s.group.add(s.shellsMesh),s.highlightGeometry=new u.c(s.voxelSize,s.voxelSize,s.voxelSize),s.highlightMaterial=new u.u({color:new u.f("#ffffff"),side:u.b}),s.highlightMesh=new u.l(s.highlightGeometry,s.highlightMaterial,s.volume),s.highlightMesh.renderOrder=1,s.group.add(s.highlightMesh);for(var p=0;p<s.size;p++)for(var v=0;v<s.size;v++)for(var g=0;g<s.size;g++){var m=p+v*s.size+g*(s.size*s.size);s.shellsMesh.setMatrixAt(m,(new u.s).makeTranslation(-(p*s.spacing-s.length/2),-(v*s.spacing-s.length/2),-(g*s.spacing-s.length/2))),s.highlightMesh.setMatrixAt(m,(new u.s).makeTranslation(-(p*s.spacing-s.length/2)-.01,-(v*s.spacing-s.length/2)-.01,-(g*s.spacing-s.length/2)-.01).scale(new u.L(1.05,1.05,1.05)))}return s.guidelines=new j(s.length,s.voxelSize,s.spacing),s}return Object(o.a)(i,[{key:"addTracer",value:function(e){this.tracers.push(e),this.group.add(e.group)}},{key:"update",value:function(e){if(this.tracerSpawnCounter++>this.tracerSpawnThreshold){for(var t=z.fromID(y(0,z.count())),i=y(1,500),n=new Array,a=new u.L(0,0,0),s=new u.L(0,0,0),r=0;r<32;r++){var h=x.UP;switch(y(0,6)){case 0:h=x.UP;break;case 1:h=x.DOWN;break;case 2:h=x.LEFT;break;case 3:h=x.RIGHT;break;case 4:h=x.FORWARD;break;case 5:h=x.BACK}var o=(new u.L).copy(h.vector).multiplyScalar(this.spacing),l=(new u.L).copy(s).add(o);l.x<-this.length/2||l.x>+this.length/2||l.y<-this.length/2||l.y>+this.length/2||l.z<-this.length/2||l.z>+this.length/2||(n.push(new O(h,this.spacing,1500)),s.copy(l))}var c=new b(t,i,a,new L(n));this.addTracer(c),this.tracerSpawnThreshold=64*Math.random(),this.tracerSpawnCounter=0}for(var d=[],f=0;f<this.tracers.length;f++){var p=this.tracers[f];if(p.update(e),p.hasReachedVoxel()){var v=this.getVoxelFromWorldCoordinates(p.position).damage(p.health,p.team);p.damage(v)}p.dead()&&(this.group.remove(p.group),d.push(f))}for(var g=d.length-1;g>=0;g--)this.tracers.splice(d[g],1)}},{key:"getVoxelFromWorldCoordinates",value:function(e){var t=e.x,i=e.y,n=e.z;return this.getVoxel({x:(t+this.length/2)/this.spacing,y:(i+this.length/2)/this.spacing,z:(n+this.length/2)/this.spacing})}},{key:"getVoxel",value:function(e){var t=e.x,i=e.y,n=e.z;return this.voxels[t][i][n]}}]),i}(g),j=function(e){Object(c.a)(i,e);var t=Object(l.a)(i);function i(e,n,a){var s;Object(h.a)(this,i),(s=t.call(this)).material=void 0,s.segments=void 0,s.material=new u.m({color:new u.f("#ffffff")});for(var r=e/2,o=new Array,l=-r;l<=r;l+=a)for(var c=-r;c<=r;c+=a)for(var d=-r;d<r;d+=a){var f=d+n/2,p=d+a-n/2,v=.1*(p-f);o.push(new u.L(l,c,f)),o.push(new u.L(l,c,f+v)),o.push(new u.L(l,c,p-v)),o.push(new u.L(l,c,p)),o.push(new u.L(l,f,c)),o.push(new u.L(l,f+v,c)),o.push(new u.L(l,p-v,c)),o.push(new u.L(l,p,c)),o.push(new u.L(f,l,c)),o.push(new u.L(f+v,l,c)),o.push(new u.L(p-v,l,c)),o.push(new u.L(p,l,c))}return s.segments=new u.n((new u.d).setFromPoints(o),s.material),s.segments.computeLineDistances(),s.group.add(s.segments),s}return i}(g),A=i(10),T=i(12),G=i(11),E=function(){function e(t){Object(h.a)(this,e),this.canvas=t,this.renderer=void 0,this.effects=void 0,this.camera=void 0,this.controls=void 0,this.scene=void 0,this.ambient=void 0,this.sun=void 0,this.lattice=void 0,this.renderer=new u.N({canvas:this.canvas,antialias:!0}),this.renderer.setSize(t.clientWidth,t.clientHeight),this.camera=new u.z(45,t.clientWidth/t.clientHeight,1,2e3),this.controls=new A.a(this.camera,this.canvas),this.controls.maxPolarAngle=Math.PI/2,this.controls.dampingFactor=.025,this.controls.enableDamping=!0,this.camera.position.set(400,400,400),this.controls.update(),this.scene=new u.E,this.scene.background=new u.f("#000000"),this.ambient=new u.a("#ffffff",1),this.scene.add(this.ambient),this.sun=new u.B("#ffffff",.5),this.sun.position.set(800,800,800),this.scene.add(this.sun),this.lattice=new k(9,16,100),this.scene.add(this.lattice.group),this.effects=new T.a(this.renderer),this.effects.addPass(new G.a(this.scene,this.camera))}return Object(o.a)(e,[{key:"draw",value:function(e){this.lattice.update(e),this.camera.aspect=this.canvas.clientWidth/this.canvas.clientHeight,this.camera.updateProjectionMatrix(),this.renderer.setSize(this.canvas.clientWidth,this.canvas.clientHeight),this.controls.update(),this.effects.render()}}]),e}(),F=function(e){Object(c.a)(i,e);var t=Object(l.a)(i);function i(e){var n;return Object(h.a)(this,i),(n=t.call(this,e)).ref=a.a.createRef(),n.game=void 0,n}return Object(o.a)(i,[{key:"componentDidMount",value:function(){var e=this;this.ref.current&&(this.game=new E(this.ref.current));var t=performance.now();requestAnimationFrame((function i(n){e.game&&e.game.draw(n-t),t=n,requestAnimationFrame(i)}))}},{key:"render",value:function(){return a.a.createElement("canvas",{className:"stretch",ref:this.ref})}}]),i}(a.a.Component);var H=function(){return a.a.createElement("div",{className:"App"},a.a.createElement(F,null))};Boolean("localhost"===window.location.hostname||"[::1]"===window.location.hostname||window.location.hostname.match(/^127(?:\.(?:25[0-5]|2[0-4][0-9]|[01]?[0-9][0-9]?)){3}$/));r.a.render(a.a.createElement(a.a.StrictMode,null,a.a.createElement(H,null)),document.getElementById("root")),"serviceWorker"in navigator&&navigator.serviceWorker.ready.then((function(e){e.unregister()})).catch((function(e){console.error(e.message)}))}},[[13,1,2]]]);
//# sourceMappingURL=main.73c8ae77.chunk.js.map